# 第 30.1 节 Linux 兼容层实现——Linuxulator、Linux 兼容层、Linux chroot 还有 Linux Jail

我们发现有很多人搞不清楚 Linuxulator、Linux 兼容层还有 Linux chroot、Linux Jail 这些名词之间的关系。所以单独开一个章节，希望能把这件事情一次性讲清楚。

## 什么是 Linuxulator

既然要谈 FreeBSD 兼容 Linux 应用程序，那么一切都要从 Linuxluator 开始说起。Linuxulator 的含义是 Linux Emulator——很容易让人联想到这是 Linux 模拟器。然而 Linuxulator 并不是传统意义上的模拟器，其本身甚至都不是具有单独可执行文件的 FreeBSD 应用程序。Linuxulator 只是 FreeBSD 官方文档中对一个 FreeBSD 内核模块的通俗称呼，这个内核模块的本名叫 `linux`。

先自己看一下 `linux` 这个内核模块的 `man` 页面吧。

```
$ man 4 linux
```

这里帮大家翻译一下最重要的部分：

> `linux` 内核模块提供了有限的 Linux ABI（应用程序二进制接口）兼容性，使得运行许多未经修改的 Linux 应用程序成为可能，而不需要虚拟化或仿真。所提供的一些设施是：
>
> - Linux 到 FreeBSD 系统调用的转换
> - Linux 限定的系统调用实现
> - 针对 Linux 进程的特殊信号处理
> - 路径转换机制
> - Linux 限定的虚拟文件系统实现

这是个什么概念呢？就是说 Linuxulator 既不是 WSL 的套壳虚拟机，也不是 WINE 的解释执行。其原理是由 FreeBSD 内核识别并捕获 Linux 进程的系统调用请求，找到 FreeBSD 与之对应的系统调用实现，再用 FreeBSD 内核的系统调用实现来回应 Linux 进程的系统调用请求。

划重点：**用 FreeBSD 内核的系统调用实现来回应 Linux 进程的系统调用请求**。

换句话说就是，借助 Linuxulator 这个内核模块，FreeBSD 内核可以把自己伪装成一个 Linux 内核，但实际上在运行 Linux 进程的依旧是 FreeBSD 内核，负责处理 Linux 系统调用的依旧是 FreeBSD 内核里的代码。并且站在 FreeBSD 内核的角度，通过 Linuxulator 运行的 Linux 进程和 FreeBSD 进程**没有本质区别**。Linux 进程就是 FreeBSD 进程。

# 什么是 Linux 兼容层

> 路径转换机制使 Linux 进程在 `/` 之前查找 `emul_path`（默认为 `/compat/linux`）下的文件路径。例如，当 Linux 进程试图打开 `/etc/passwd` 时，它将真正访问 `/compat/linux/etc/passwd`，除非后者不存在。这被用来确保 Linux 进程加载 Linux 共享库，而不是类似名字的 FreeBSD 对应库，同时也提供了某些其他文件和虚拟文件系统的替代版本。

# 什么是 Linux chroot

# 什么是 Linux Jail
