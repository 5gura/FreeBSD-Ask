# 第30.1节 Linux 兼容层实现 —— Linuxulator、Linux 兼容层、 Linux chroot 还有 Linux Jail

我们发现有很多人搞不清楚 Linuxulator、Linux 兼容层还有 Linux chroot、Linux Jail 这些名词之间的关系。所以单独开一个章节，希望能把这件事情一次性讲清楚。

## 什么是 Linuxulator

既然要谈 FreeBSD 对 Linux 应用程序的兼容，那么一切都要从 Linuxluator 这个内核模块开始说起。而 Linuxulator 其实是一个 FreeBSD 内核模块的别名，这个模块其实叫 `linux`。先自己看一下 `linux` 这个内核模块的 `man` 页面吧。

```
$ man 4 linux
```

这里帮大家翻译一下最重要的部分：

> `linux` 内核模块提供了有限的 Linux ABI（应用程序二进制接口）兼容性，使得运行许多未经修改的 Linux 应用程序成为可能，而不需要虚拟化或仿真。所提供的一些设施是：
>
> - Linux 到 FreeBSD 系统调用的转换
> - Linux 限定的系统调用实现
> - 针对 Linux 进程的特殊信号处理
> - 路径转换机制
> - Linux 限定的虚拟文件系统实现
>
> 路径转换机制使 Linux 进程在 `/` 之前查找 `emul_path`（默认为 `/compat/linux`）下的文件路径。例如，当 Linux 进程试图打开 `/etc/passwd` 时，它将真正访问 `/compat/linux/etc/passwd`，除非后者不存在。这被用来确保 Linux 进程加载 Linux 共享库，而不是类似名字的 FreeBSD 对应库，同时也提供了某些其他文件和虚拟文件系统的替代版本。

这是个什么概念呢？就是说 FreeBSD 的 Linuxulator 既不是 WSL 2 的套壳虚拟机，也不是 WINE 的解释执行。其原理更加接近以前的 WSL 1：由 FreeBSD 内核识别并捕获 Linux 系统调用请求，找到 FreeBSD 与之对应的系统调用实现，再用 FreeBSD 内核的系统调用实现来回应 Linux 应用程序的系统调用请求。

> 划重点：**用 FreeBSD 内核的系统调用实现来回应 Linux 应用程序的系统调用请求**
>
> 站在 FreeBSD 内核的角度，通过 Linuxulator 运行的 Linux 应用程序和原生的 FreeBSD 应用程序**没有本质区别**。
